## Monday {{date}}

- [x] [Update Telework](https://docs.google.com/spreadsheets/d/16AZZBiKL1s6eGgH2KFiJPnD8-TjRsC0HYy4Qdmbr358/edit#gid=0)

[Massive PR](https://github.com/star-bnl/star-sw/pull/366)
- logic was inverted in the FGT cluster maker for rejecting nullptr hits
- libquadmath is being linked on the FORtran side...
	- would be useful to know what the warning this solves is b/c changing precision has bit us hard before.
	- minor error, so should be good.
	- Few additional commits coming in as we go... 

- SHREK... run latest test... and still broke.  Tadashi had found something pilot related (I think) on Friday... I guess Paul has not had a chance ot look at this...

- Distributed computing... asked Tadashi / Paul for an update... 

- Okay... some refactoring to implement the git / documentation layer for production...
	- Implement a configuration file for shrek  (Site, vo, etc...) on configuration branch.
	- Max number of submissions --> config parameter
	- Now need to implement the scheme.
		- tag --> submission directory
		- branches for
			- development (default) : dev
			- test submission (dry run) : test
			- submission : production
			- ... should make submission directory a parameter...  this will be the local directory under git control.

... something is ... screwy... network keeps hanging ...

- Now have the code in shape to archive submissions onto github.  Will retask the buildSubmissionDirectory script for github.  
- I still need to decide on a github / api.... or should I just shell out and do github requests direct?

May as well use the github REST api... take the time to learn something useful...
[THIS](https://docs.github.com/en/rest/guides/getting-started-with-the-rest-api)

Thinking about how to handle the git interaction... in terms of password / token / security... I probably shouldn't deal with this?  I suspect that git will ask for authorization whenever needed... should do a quick trial run w/ the tutorials...

This command will result in github requesting authentication...
`curl -i -u klendath2k https://api.github.com/users/klendathu2k`

Curl does not hold onto the authentication however...

[OAuth](https://docs.github.com/en/developers/apps/building-oauth-apps)

would be one possible way to provide authentication... but I think for now, the downside of providing the password / token when we *push* the documentation is reasonable...

Wait... a... tick...

An s-ton of useful s... here, but not exactly what I require here... I don't think.  This is the api for github...  This is how to interact with the web api... work with github... but whataboutworkingwiththelocalrepository...

Need to interact with the local repo in order to commit...

This appears to be what I need...
[Pygit2](https://www.pygit2.org/recipes.html)

For example...
```
>>> import pygit2
>>> repo = pygit2.Repository("/sphenix/u/jwebb2/work/2022/SHREK/sPHENIX-test-production")
>>> print(repo.branches)
<pygit2.repository.Branches object at 0x7f738e9abb80>
>>> print(list(repo.branches))
['main', 'origin/HEAD', 'origin/main']
>>> print(list(repo.branches.local))
['main']
>>> print(list(repo.branches.remote))
['origin/HEAD', 'origin/main']
```

... I ought to have a "test" and "devel" branch shown... both local and remote...

... albeit perhaps a bit more low level than I would care to deal with...
https://github.com/MichaelBoselowitz/pygit2-examples/blob/master/examples.py

Another option seems to be GitPython...
https://gitpython.readthedocs.io/en/stable/tutorial.html#initializing-a-repository

Looks simple to commit ... but switching branches... documentation is confusing...
https://gitpython.readthedocs.io/en/stable/tutorial.html#switching-branches

First they show us the quick and dirty way to overwrite whatever you were just working on...  seems risky...

Then they tell us to do it this way, which seems simple... but it sure looks too simple... 

GitPython does provide the ability to directly shell out to the git command line... but then again, so does subprocess... 

Semi-interesting spin off project ... but not useful in this context... https://github.com/Byron/gitoxide

---

So... let's think a bit more... I have the shrek-submit command that submits jobs to PanDA...

It builds the submission scripts and artifacts in a specified directory.

That directory... should be under git control.
That directory... should be on one of three branches (test,devel,production)

Now.  How do we want to interact with the system.  

Option 1:

```
# Set the git context to development
shrek --set devel

# Create the workflow and submission directory
shrek --build --tag hfcharm tests/charm/*.yaml

# Submit the job
shrek --submit 

# And archive the job
shrek --archive
```

Option 2:

```
# Alternatively... commands can be combined
shrek --set devel --build --tag hfcharm tests/charm/*.yaml --submit --archive
```

I guess we go with option 2 for now.  I can always split things off at a later date.  Goal is to get to a functional system ASAP.

So.  Shrek needs to be updated to switch branches on the directory when invoked.  

Defaults to the devel branch.

On each call, the workflow is created, and git commit is called.

If --submit is invoked, the README.md is updated, the changes are committed, and the results are pushed.

--> this will require (annoyingly) us to provide our github credentials.











