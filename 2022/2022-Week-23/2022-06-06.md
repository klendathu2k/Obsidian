## Monday {{date}}

- [ ] [Update Telework](https://docs.google.com/spreadsheets/d/16AZZBiKL1s6eGgH2KFiJPnD8-TjRsC0HYy4Qdmbr358/edit#gid=0)

Hallway discussion w/ Kolja regarding geometry representations...  Dug up a [presentation](https://docs.google.com/presentation/d/1cXiCbyErepP6Hs8_O0mw4AnWj4jptTXAnbL7EFVh4I8/edit?usp=sharing) I gave to EIC from ~2019 giving an (incomplete, slightly biased) summary of available frameworks / toolkits.

Originally presented [here](https://indico.jlab.org/event/216/timetable/)

At that time had reviewed the FairRoot, DD4Hep, GEMC frameworks, plus discussed the use of AgML in STAR.  Did not examine F4A.  

Current use case for EIC (discussed w/ Kolja) is that there should be alot of swapping out of subsystems against a baseline detector.  So...

Requirement is for modularity.   In particular, modularity of the geometry *and* the data model.  At least insofar as being able to assign a unique identify to each physical sensitive volume.  In that I see support provided in DD4Hep... although it seems to be heavyweigt.  With AgML we assign a unique ID to each SV.  (It is used defined function... not attached to geometry but easily could be).  

Looking at the DD4Hep code... signivficant amounts of boilerplate code need to be created to build a functional geometry model.  While it is modular, the overhead reduces this utility.

... had been thinking along some of these lines already so going to write these things down (plus brain isn't otherwise functional)...

SO... thinking about a greenfield approach.  What would it take to build a functional system with low boilerplate?

Full (sub) detector description should be based around a module file.
Domain specific language... ala AgML... but could be / should be simplified.  In particular, a better goal would be a direct export to target geometry model rather than the call-into-library approach taken by AgML.

Geometry modeling language with extensions to support the definition of sensitive volumes.

Automatic creation of unique volume ID... based on geometry modules which define the detector.

Declaritive syntax for hits *defined in the geometry module*

Support for iteration, branching, data structures...  

Well, need to recall why XML was chosen tn the first place.  It provided a simple parser... able to define the language constructs, but leave expressions up to the target compiler... c++ or FORtran... making AgML a polyglot language.  One preprocessor two target languages.

A declaritive language based on YAML?

```
Materials:
  Air: Ni 78% Oxygen 20.1% Argon 0.9% ...
 
Structures:
  - Name: TpcMotherData
    Comment: Mother volume parameters
	Rmin: 60.0
	Rmax: 200.0
	dZ: 200.0
	Nsectors: 12
 
Volume:
  Name: TpcMother
  Material: Air
  Cylinder: Rmin=TpcMotherData.Rmin Rmax=TpcMotherData.Rmax dZ=... 
  Contents:|-
    for i in range(0,TpcMotherData.Nsectors):
	  Place: 
	    ...
```

I think that rather quickly... YAML would become cumbersome... for same reasons that json would become cumbersome...  with XML I can define

`<Tag var1="..." var2="..." />` OR

```
<Tag>
  <Var1>...</Var1>
  <Var2>...</Var2>
</Tag>
```

But with yaml, json (and others) only the second form is supported.  So... the definition of Air above would require backing code to parse a string... no ability here to do schema checking until realized by the libarry.

So staying with XML parser would be somewhat more compact.

...

AgML would export to c++ which could be dynamically compiled using cling.  So geometries would plug in.

Structures would be simplified... no need to support the old MORtran way of doing things in STAR... so these could be direct c structs.

Better... leverage podio to define data structs... persistency.

Leverage podio to define hit data structures.  

Use lambda functions to define user hits... as well as define default functionals which return specific quantities.
