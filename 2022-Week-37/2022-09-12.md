## Monday {{date}}

- [x] [Update Telework](https://docs.google.com/spreadsheets/d/16AZZBiKL1s6eGgH2KFiJPnD8-TjRsC0HYy4Qdmbr358/edit#gid=0) âœ… 2022-09-12

------------------------

STAR Collaboration meeting this week.  

Monday -- Junior's Day

Probably not worth sitting in on many talks, but will zoom connect into Rongrong's and Daniel's presentations @ 1030 AM.   Theory talk from a (new-ish) NMSU prof... too bad it's not Mattias. 



Tuesday -- Parallel Sessions

Some interesting looking cold QCD talks... 

Wednesday -- Parallel Sessions

Hard probes WG... Talk on a pythia model... May be worth catching.

Thursday -- Plenary Sessions...

Should attend the morning sessions.  (WIll need to take the afternoon sessions from home by remote b/c Brianna has gym... but need to double check this...)

Friday -- Plenary Sessions

Again, morning sessions should be interesting / relevant.

---------------

sPHENIX Production

```
$ rucio ls user.jwebb2:user.jwebb2.sP22s-hfcharm-signal-test10_000_Pythia8CharmSimulation_Pythia8CharmSimulation.outDS.tar
+-----------------------------------------------------------------------------------------------------------------+-------------------+
| SCOPE:NAME                                                                                                      | [DID TYPE]        |
|-----------------------------------------------------------------------------------------------------------------+-------------------|
| user.jwebb2:user.jwebb2.sP22s-hfcharm-signal-test10_000_Pythia8CharmSimulation_Pythia8CharmSimulation.outDS.tar | DIDType.CONTAINER |
+-----------------------------------------------------------------------------------------------------------------+-------------------+


$ rucio ls --filter type=CONTAINER user.jwebb2:*
...



```
```
```


List all DIDs that are containers
`$ rucio ls --filter type=CONTAINER user.jwebb2:*`



Filter based on date
`$ rucio ls --filter "updated_at>2022-09-03 00:00:00" user.jwebb2:*`

Wildcards on name do not appear to be supported... e.g. match "?"
`rucio ls user.jwebb2:user.jwebb2.sP22s-hfcharm-background-test1?_000_Pythia8MinbSimulation_Pythia8MinbSimulation.outDS.tar`


---------------------

watchRucioForNewInputs.py
(alias to donkey-watch)

```
submitted = []

# Arguements...
# starttime -- defaults to the last time in the donkey.lasttime file
# endtime -- defaults to none... 
# match -- pattern match for files in rucio
# scope -- the scope in rucio to watch
# period -- time (in minutes) to delay between polling

# How to  forward arguments to shrek?


LASTSUBMISSIONUTC = opts.starttime

def OnException():
	print("Rucio watcher ends at %s"%now())
	with stopped as open('donkey.lasttime'):
		stopped.write( now() )


while _runit:
    inputs=shell.rucio( 'ls', 
                        '--filter', 
                        'created_at>%s'%LASTSUBMISSIONUTC,
                        '%s:%s'%(SCOPE,MATCHING) )
                        )

	submitted, LASTSUBMISSIONUTC = addInputsToQueueAndSubmit( inputs )

	sleep( 60 * opts.period )

```
		


A quick example script has been implemented.  Basic idea is that we monitor rucio periodically to find datasets which have been added, then submit new jobs to PanDA.

Makes a few assumptions....
1) THat the sPHENIX daq will (ultimately) push datasets out to rucio
2) That each dataset will contain a complete set of files needed for a given run at the experiment
3) That (perhaps) each dataset corresponds to a single run
