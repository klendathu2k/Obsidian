## Wednesday 04/13

- [ ] 0830AM [NPPS Coffee](https://bnl.zoomgov.com/j/16157150845?pwd=NXNqTi9ZWEFBKzYwRXQ5U3NXU1dBZz09)
- [ ] 1200PM [STAR S&C Meeting](https://lbnl.zoom.us/j/97026562983?pwd=VGVXbzhYUUhheEJ2cFMyVVdVRXowZz09)

SHREK
----

Copy the schema for shrek from yesterdays [[2022-04-12]] notes to the [[SHREK]] document.

Would prefer to have a schema definition tool to validate yaml files against.
[Some options](https://json-schema-everywhere.github.io/yaml) to research.

[Some more options](https://stackoverflow.com/questions/3262569/validating-a-yaml-document-in-python)
- [Nice doggie...](https://docs.python-cerberus.org/en/stable/)
- [PyKwalify](https://pypi.org/project/pykwalify/)
- [schema](https://pypi.org/project/schema/)

Of the above... Cerebus and PyKwalify are about at the same level in terms of maturity, maintenence and license... schema is a bit behind...  installation by pip for all 3.  

PyKwalify wins the coin flip...
[Supports partial schema definitions](https://pykwalify.readthedocs.io/en/master/partial-schemas.html)
- Can therefore develop schema based on each section of the document, and then expand to full blown specification for the yaml file...
- Can therefore setup test suite... using pytest... 


Next, setup test documents and build up a schema for the yaml files which will be used as input to the shrek-submit application, to build up the workflow for PanDA submission.  Bleh.

Partial [schema](https://github.com/klendathu2k/shrek/tree/schema/schema) are now defined for the blocks of code that users should implement in their job definition files.   With unit testing (schema must validate against example files.)

One issue is that the schema does not seem to enforce mandatory arguements?  No matter... the python class we fill can do this (and will provide better error messages).

Next need to build up the full schema for the job definition document.  These documents will be yaml files, but carry the .shrek suffix.  The general design at this point is...

![SHREK](https://lh4.googleusercontent.com/G5w4P1uwUYpU-ObA8T3fDdm27jEm66IxTQ-sHTB8_LGZQbZpQK4xGBMeMpDTHxCBIPt9_vnBkuWdjTYcaTGBhjLEMC4giqNX_YLv9d5RR6G4mJgOiw9O9e1q4l-GcA1dZMVp1Nl-) 

... each "pass" in the diagram above will be implemented as a single yaml (shrek) file.  aka job description file.  These JDFs will be organized in a hierarchy of directories.  The PanDA workflow (CWL) files will be built by traversing the directory tree, reading in the JDFs, and building the workflow from there.  This is in analogy to the unix system V initialization scheme.






starsim
---

- SL16d_embed bug...
	- Jinlong reports the AgNEED issue is still present after starsim recompiled under cvmfs
	- Confirmed that code appears to be correctly compiled
	- Asked Jinlong to confirm that he is running in CVMFS and (if so) to run a test against DEV.
	- Strongly suspect he is not running against CVMFS deployed lib.
		- Probab ly is based on Gene's comment re logfile
	- Learn something everyday... gdb "info common" command, to display info about a common block.  Hrmfph.
	- 
	
