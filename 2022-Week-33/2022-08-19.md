## Friday {{date}}

- [ ] 1000AM [NPPS Weekly Meeting](https://docs.google.com/document/d/1YfTyXPeXNQU4XUB28bvHJolgyBIJ2bfrd0u9Gd3WD70/edit)[zoom](https://bnl.zoomgov.com/j/16157150845?pwd=NXNqTi9ZWEFBKzYwRXQ5U3NXU1dBZz09)
- [ ] TODO: Weekly Summary

### sP22s-hfcharm-signal-test1

500 jobs @ 100 events / job success?
https://panda-doma.cern.ch/task/132934/


Yes.  Everything completed with approx 1h45m runtime.
![[Pasted image 20220819084026.png]]

So... able to scale up to ~100 events w/out issue.  

### sP22s-hfcharm-background-test1

How big can we run the background sample? 100 jobs b/c limited by the number of HEPMC input files.  100 events should be getting into the 2h wall time limit.  So this will be a valid test.  Release the hounds...

[sP22s-hfcharm-background](https://panda-doma.cern.ch/tasks/?taskname=user.jwebb2.sP22s-hfcharm-background-test1_*)

Scout jobs finished in ~ 1h... (would have expected ~2h but okay... can scale by x5 at next step)...

Succeeded
https://panda-doma.cern.ch/tasks/?jeditaskid=132936|132937#plots

![[Pasted image 20220819124629.png]]

------------------------

Turning back to the conditional workflow 

[PanDA conditional workflow](https://panda-wms.readthedocs.io/en/latest/client/pchain.html#conditional-workflow)
[CWL conditional workflow](https://www.commonwl.org/user_guide/24_conditional-workflow/index.html)

PanDA conditional workflow... example shows how to check whether the job succeeded or not.   CWL has much more flexability than that... but perhaps we don't need?

The conditional needs to attach to each step in the CWL.  

![[Pasted image 20220819104313.png]]

So... a few things to consider...  Each job is expressed in a single yaml file specifying its inputs and outputs.  These get setup as a step in the CWL file.  

We can add a "when" expression in the parameters block.  That can be added as a "when: (condition)" statement in the CWL step for that yaml file.

The problem becomes now the output.  So... each task above should probably have, e.g., 

Pass4TrackStage0 and Pass4Stage0_FailedIn or Pass3_FailedOut
Pass4TrackStageA and Pass4StageA_FailedIn or Pass4_0_FailedOut
Pass4TrackStageC and Pass4StageC_FailedIn or Pass4_A_FailedOut

To create an output stub where failed outputs can go to die...

Doesn't seem to work... the workflow disappeared into the maw of the PanDA and was never seen again (no error reported, no jobs show up on the workflow monitor...)

So... the CWL documentation states that if no conditions are met... it results in a permanent failure.  So ... I would presume I could submit something w/ incomplete coverage on the cases... but it would hang???  Or are the inputs resolved at submission time?  I'm not sure what condition is being tested here.  The presence of the file or the presence of a filename?

... but I can confirm that, using the example conditional workflow... I can omit half of the branch and the code will run.

--------------------------------

Setup a run with the conditional wofkflow statements added.  10 jobs against the newest dataset...

... should be aware that the input DS should never fail b/c we create the tar file regardless of the status of the generating job...

... added the condition on one of the jobs... and we did not even submit the workflow... (or rather... PanDA does not even show it )

Okay... so just do the standard workflow... tests full chain scaling to 100 events...
10 jobs succeeded.  (test1) setup next test with full dataset...