## Thursday {{date}}
-------------------------------------------------
SHREK / sPHENIX workflows

10 HF x 50 minb : 10 pileup : reco
[Jobs still running](https://panda-doma.cern.ch/tasks/?jeditaskid=131780|131779|131781|131772|131752|131751)

... welll.... still not running to completion?  Why not?

Let's simplify to a small # of events...

Because downstream jobs depend on them... have 3 max attempts for the generation jobs.

Let's also remove the uuid (actually make that an option) from the tag.

So... everything should be accessible via *sP22b-hfcharm* in rucio.

-------------------------------------------------

Work on ... [[Rucio Notes]]

-------------------------------------------------
```
$ rucio ls user.jwebb2:user.jwebb2.simple-f49d636e-ecc1-11ec-8ff4-00163e101048*

8 DIDs (4 containers, 4 datasets)

$ $ rucio get-metadata user.jwebb2:user.jwebb2.simple-f49d636e-ecc1-11ec-8ff4-00163e101048_000_top.log

... returns alot of metadata ...

$ rucio set-metadata user.jwebb2:user.jwebb2.simple-f49d636e-ecc1-11ec-8ff4-00163e101048_000_top.log
usage: rucio set-metadata [-h] --did DID --key KEY --value VALUE
rucio set-metadata: error: the following arguments are required: --did, --key, --value

... setting an existing meta data key/value works.  Creating a new one doesn't ...

```

-------------------------------------------------

One thing that I am seeing... every step in the workflow creates output.  This is not what I want.  What I want is the final mergeOutputs step to save output....

-------------------------------------------------

I *think* that we should setup the intermediate jobs such that they do not create the output DS.  Allow no output.

How would SHREK manage this?  

So first... need to run a test job...

.... but. ... staring at the  CWL file... I  am not convinced that I can supress the creation of a dataset.  Right?  b/c the --outDS field for prun is generated by the pchain / panda / cwl monstrosity...


--------------------------------------------------

Another consideration... the name(s) of the datasets are rather... expansive

user.jwebb2.sP22a-hfcharm-0e0a471c-0e88-11ed-8dd4-00163e101049

The "uuid" at the end.  Should probably only be used in a testing context...


--------------------------------------------------

Also... How can I tell PanDA that output should go into a specific container?  Rather than have to deal with the flat mess it creates post-hoc?

--------------------------------------------------

How can I rename a DID?  Change its name in metadata?
NOPE!  "name" is protected in meta data.  (at least sphnxpro cannot change a name of a did whose scope is jwebb2)

--------------------------------------------------

HOWTO Add a dataset
```
$ rucio add-dataset user.jwebb2:testDS-12345
Added user.jwebb2:testDS-12345

```

HOWTO Add a container
```
$ rucio add-container user.jwebb2:testContainer
Added user.jwebb2:testContainer
```

HOWTO attach a dataset to a container
```
$ rucio attach user.jwebb2:testContainer user.jwebb2:testDS-12345
DIDs successfully attached to user.jwebb2:testContainer
```

HOWTO list the parents of a DID
```
$ rucio list-parent-dids user.jwebb2:testDS-12345
+---------------------------+--------------+
| SCOPE:NAME                | [DID TYPE]   |
|---------------------------+--------------|
| user.jwebb2:testContainer | CONTAINER    |
+---------------------------+--------------+
```

HOWTO list the contents of a DID
... when you set a parent-child relationship, the parent's content includes the children...
```
$ rucio list-content user.jwebb2:testContainer
+--------------------------+--------------+
| SCOPE:NAME               | [DID TYPE]   |
|--------------------------+--------------|
| user.jwebb2:testDS-12345 | DATASET      |
+--------------------------+--------------+
```

HOWTO delete a DID...

Note:  this does not delete, but rather *schedules* the DID to expire 24h from the time that the command was executed.

```
$ rucio erase -h
usage: rucio erase [-h] [--undo] dids [dids ...]

This command sets the lifetime of the DID in order to expire in the next 24 hours. After this time, the dataset is eligible for deletion. The deletion is not reversible after 24 hours grace time period expired.

positional arguments:
  dids        List of space separated data identifiers.

optional arguments:
  -h, --help  show this help message and exit
  --undo      Undo erase DIDs. Only works if has been less than 24 hours since erase operation.


$ rucio erase user.jwebb2:testDS-12345  user.jwebb2:testContainer
2022-07-28 13:36:53,024	INFO	CAUTION! erase operation is irreversible after 24 hours. To cancel this operation you can run the following command:
rucio erase --undo user.jwebb2:testDS-12345
2022-07-28 13:36:53,040	INFO	CAUTION! erase operation is irreversible after 24 hours. To cancel this operation you can run the following command:
rucio erase --undo user.jwebb2:testContainer

```

Okay... how about erasing several DIDs...

```
$ rucio erase user.jwebb2:user.jwebb2.TestSimu-*
2022-07-28 14:41:03,098	WARNING	This command doesn't support wildcards! Skipping DID: user.jwebb2:user.jwebb2.TestSimu-*
```

Wah wah wah wah....

So we needs to do a bit of scripting to be truly truly dangerous about this...

```
for i in `rucio ls --short user.jwebb2:*Test*`; do rucio erase $i; done
```

If I delete a container, do the contents go too?

