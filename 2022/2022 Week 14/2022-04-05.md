- sPHENIX Production / SHREK
	- Tadashi does not seem interested in adding the CWL InitialWorkDir entries into the tarball sent to the condor.... 
		- Naively I am assuming that PanDA is executing the CWL file with a CWL-runner on the remote server. 
		-  If so, then the shell scripts created by the CWL InitialWorkDir requirement would be available and could be added to the tarball without much effort on his part.
		-  Could there be security concerns?  (Same concerns/solutuions for uploading the user code tarball I would imagine)
		-  OTOH, if PanDA is handling the workflow itself (i.e. if PanDA is a CWL runner) then it may be more effort to implement this than he has time for.
	- Either way... pays off to think about other options for achieving the same goal...
		- When in doubt... templates
		- Natural solution here.  The workflows themselves will be fixed, so we only need to update wtih changes to parameters (such as input data sets, user scripts to run, etc...)
		- In the language specification... $ is reserved for expressions, # for comments.  % is reserved by the PanDA.  [array] is the array syntax.  So... let's reserve @VAR as a template substitution.  Any token beginning with @XYZ will be replaced with XYZ as defined in some input file....  
	- Actually,... I must think of another solution.  PanDA cannot support this feature (tarball is pushed before cwl-runner can provide the initial work directory...)
		- Need to think through what needs to be templated...
			- @PRODUCTION_TAG
			- @SOFTWARE_TAG
			- @INPUT_DATASET
			- @OUTPUT_FILENAME
			- @OUTPUT_TARGET_DIRECTORY
			- ...
		- Another possibilitiy is to .... no.  Just no.  Wait for it... but... no... yes?  no.  No no no no...
			- Si.
			- Run cwl-runner on the remote machine to wrap the job.  Done.
			- Okay... cwl-runner is not avail on sphnxpro.  But this can be massaged.
			- Okay... here is an important note.  cwl-runner does not seem to care that the yaml file has more input fields than those that are defined w/in the CWL file.  So...
			- As long as I have a cwl-runner installed on the remote system, I can setup the remote scripts the way I want to...
	
So... I think I have converged (am converging) on a design...

One job can be completely specified as a YAML file.  Input DS (possibly null), run scripts, inputs to said run scripts, macros, etc...

Different tools (CWL workflows) can be defined to run:
- pchain --cwl reco.cwl --yaml production-tag.yaml :: defines the production type and associates the sub workflows.
	- reco.cwl :: data reconstruction
	- simu.cwl :: pure simulation plus reconstruction
	- pileup.cwl :: pure simulation with pileup background
	- overlay.cwl... embedding.cwl ...  TBD
- shrek.cwl production-tag/passN.yaml  :: defines the work to be done in each pass as defined in production.cwl
- donkey.cwl production-tag.yaml :: responsible for staging / confirming the staging of the input data sets
- fiona.cwl productio-tag.yaml :: responsible for generating the documentation ... markdown based ... github archive



---

Embedding job to be debugged... Jinlong Zhang reaching an assert... container (StArray) being pushed back twice... ??  
- 4 sets of code checked out... (generators, trigger, filter, spinpool )
- FZD file is fixed (no event generation)
- daq file list (but order should be fixed here)
- Randomly crashes... (so TpcRS etc... randomization...)  
	- Code smell... is this that old TPC clustering bug... size of work array... thought that bug was introduced / fixed later.  But maybe updated SL16d_embed library caught it by mistake?
	- May take a while to crash...
	- Lots of shennanigans being played in the event generation macro, but nothing that should caure problems reported in reconstruction
		- ... just show stoppers when we go to production
	- Probably not a good idea... but try switching to TRS...
		- Immediately segfaults b/c someone can't setup his dependencies correctly.
	- I don't see the trigger filter being given permission to abort events...  ???


--- 

Really regretting the 36-pack of granola bars I picked up at Walmart to have on hand in the office...

---




